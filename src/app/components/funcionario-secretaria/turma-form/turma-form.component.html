<div class="container mt-4">
  <h2>{{ isEditMode ? 'Editar Turma' : 'Nova Turma' }}</h2>
  <form [formGroup]="turmaForm" (ngSubmit)="onSubmit()">

    <div class="form-row">
      <div class="form-group col-md-6">
        <label for="materiaId">Matéria</label>
        <select id="materiaId" formControlName="materiaId" class="form-control" (change)="onMateriaChange($event)">
          <option value="" disabled>Selecione uma matéria</option>
          <option *ngFor="let materia of materias" [value]="materia.id">{{ materia.titulo }}</option>
        </select>
      </div>
      <div class="form-group col-md-6">
        <label for="professorId">Professor</label>
        <select id="professorId" formControlName="professorId" class="form-control">
          <option value="" disabled>Selecione um professor</option>
          <option *ngFor="let professor of professores" [value]="professor.id">{{ professor.nome }}</option>
        </select>
      </div>
    </div>

    <div class="form-row">
      <div class="form-group col-md-3">
        <label for="turno">Turno</label>
        <select id="turno" formControlName="turno" class="form-control">
          <option value="" disabled>Selecione um turno</option>
          <option value="MANHA">Manhã</option>
          <option value="TARDE">Tarde</option>
          <option value="NOITE">Noite</option>
        </select>
      </div>
      <div class="form-group col-md-3">
        <label for="diaSemana">Dia da Semana</label>
        <select id="diaSemana" formControlName="diaSemana" class="form-control">
          <option value="" disabled>Selecione um dia</option>
          <option value="SEGUNDA">Segunda-feira</option>
          <option value="TERCA">Terça-feira</option>
          <option value="QUARTA">Quarta-feira</option>
          <option value="QUINTA">Quinta-feira</option>
          <option value="SEXTA">Sexta-feira</option>
        </select>
      </div>
      <div class="form-group col-md-3">
        <label for="campus">Campus</label>
        <select id="campus" formControlName="campus" class="form-control">
          <option value="" disabled>Selecione um campus</option>
          <option *ngFor="let campus of campi" [value]="campus">{{ campus }}</option>
        </select>
      </div>
      <div class="form-group col-md-3">
        <label for="limiteAlunos">Limite de Alunos</label>
        <input type="number" id="limiteAlunos" formControlName="limiteAlunos" class="form-control">
      </div>
    </div>

    <hr>

    <h4>Alunos Elegíveis</h4>
    <p *ngIf="!turmaForm.get('campus')?.value || !turmaForm.get('materiaId')?.value">
      Selecione uma matéria e um campus para ver os alunos elegíveis.
    </p>
    <p>Selecionados: {{ turmaForm.get('alunoIds')?.value.length || 0 }} de {{ turmaForm.get('limiteAlunos')?.value }}</p>

    <div class="aluno-list">
      <div *ngIf="alunosElegiveis.length === 0 && turmaForm.get('campus')?.value && turmaForm.get('materiaId')?.value">
        Nenhum aluno elegível encontrado para os filtros selecionados.
      </div>
      <div *ngFor="let aluno of alunosElegiveis; let i = index" class="form-check">
        <input class="form-check-input"
               type="checkbox"
               [id]="'aluno' + i"
               [checked]="isAlunoSelecionado(aluno.id)"
               (change)="onAlunoSelect(aluno.id, $event)">
        <label class="form-check-label" [for]="'aluno' + i">
          {{ aluno.nome }} (Matrícula: {{ aluno.matricula }})
        </label>
      </div>
    </div>

    <div class="mt-4">
      <button type="submit" class="btn btn-primary" [disabled]="turmaForm.invalid">
        {{ isEditMode ? 'Atualizar' : 'Salvar' }}
      </button>
      <a routerLink="/funcionariosecretaria/turmas" class="btn btn-secondary ml-2">Cancelar</a>
    </div>

  </form>
</div> 